<script>
  const total = 10;
  const contenedor = document.getElementById("contenedor");
  const STORAGE_KEY = "fila1_data";

  // Cargar datos guardados o crear estructura vacía
  let datos = JSON.parse(localStorage.getItem(STORAGE_KEY)) ||
    Array.from({ length: total }, () => ({
      codigo: "",
      imagen: null
    }));

  // Crear filas
  for (let i = 0; i < total; i++) {
    contenedor.innerHTML += `
      <div class="fila">
        <input
          type="text"
          placeholder="x[${i}] código"
          value="${datos[i].codigo}"
          oninput="guardarCodigo(${i}, this.value)"
        >

        <input
          type="file"
          accept="image/*"
          capture="environment"
          onchange="guardarImagen(event, ${i})"
        >

        <img id="img${i}">
      </div>
    `;
  }

  // Mostrar imágenes guardadas
  datos.forEach((item, i) => {
    if (item.imagen) {
      const img = document.getElementById(`img${i}`);
      img.src = item.imagen;
      img.style.display = "block";
    }
  });

  // Guardar código
  function guardarCodigo(index, valor) {
    datos[index].codigo = valor.trim();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(datos));
  }

  // Guardar imagen
  function guardarImagen(event, index) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      datos[index].imagen = reader.result;

      const img = document.getElementById(`img${index}`);
      img.src = reader.result;
      img.style.display = "block";

      localStorage.setItem(STORAGE_KEY, JSON.stringify(datos));
    };
    reader.readAsDataURL(file);
  }
</script>
